---
- name: "run common role against all"
  hosts: all
  become: true
  roles:
    - role: "common"
      tags: ["common", "base"]

- name: "setup consul"
  hosts: all
  become: true
  tags: ["consul"]
  roles:
    - role: "consul"

- name: "setup keepalived"
  hosts: ["frontend", "db", "lb"]
  become: true
  tags: ["keepalived"]
  roles:
    - role: "keepalived"

- name: "setup frontend hosts"
  hosts: frontend
  become: true
  tags: ["frontend", "application"]
  roles:
    - role: "nginx"
      tags: ["nginx", "frontend"]
    - role: "demo-app"
      tags: ["demo-app", "frontend"]

- name: "setup database nodes"
  hosts: db
  become: true
  tags: ["db", "application"]
  roles:
    - role: "postgres"
      tags: ["postgres", "db"]
      environment:
        PGDATA: "{{ postgres.data_directory }}"
